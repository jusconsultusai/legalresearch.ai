services:
  onlyoffice:
    image: onlyoffice/documentserver:latest
    container_name: jusconsultus-onlyoffice
    ports:
      - "8000:80"
      - "8443:443"
    environment:
      # JWT secret for secure communication
      JWT_ENABLED: "true"
      JWT_SECRET: "${ONLYOFFICE_JWT_SECRET:-your-secret-key-change-in-production}"
      JWT_HEADER: "Authorization"
      # Database connection (optional - uses SQLite by default)
      # DB_TYPE: postgres
      # DB_HOST: postgres
      # DB_PORT: 5432
      # DB_NAME: onlyoffice
      # DB_USER: onlyoffice
      # DB_PWD: onlyoffice
      # Redis for caching (optional but recommended for production)
      # REDIS_SERVER_HOST: redis
      # REDIS_SERVER_PORT: 6379
    volumes:
      - onlyoffice-data:/var/www/onlyoffice/Data
      - onlyoffice-logs:/var/log/onlyoffice
      - onlyoffice-fonts:/usr/share/fonts
    # Ensure host.docker.internal resolves to the Docker host's IPv4 gateway
    # so ONLYOFFICE can reach the Next.js server running on the host machine.
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/healthcheck"]
      interval: 15s
      timeout: 5s
      retries: 5
      start_period: 60s

volumes:
  onlyoffice-data:
  onlyoffice-logs:
  onlyoffice-fonts:
